Thank you to 
David Collie (University of Edinburgh) 
for their help in debugging the code.
